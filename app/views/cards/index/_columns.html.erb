<% cache @cache_key do %>
  <%= turbo_frame_tag :card_columns do %>
    <div class="card-columns" data-controller="collapsible-columns" data-collapsible-columns-collapsed-class="is-collapsed">

      <div class="title-nav">
        <h1 class="header__title overflow-ellipsis margin-block-end">
          <%= @user_filtering.selected_collections_label %>
        </h1>

        <% user_filtering.collections.limit(5).last(4).each do |collection| %>
          <div class="header__title overflow-ellipsis">
            <%= link_to collection.name, cards_path(collection_ids: [ collection ]), class: "btn btn--plain font-weight-black txt-subtle txt-normal" %>
          </div>
        <% end %>
      </div>

      <%= render "cards/index/engagement/on_deck", user_filtering: user_filtering, **on_deck.to_h %>
      <%= render "cards/index/engagement/considering", user_filtering: user_filtering, **considering.to_h %>

      <% if workflow = user_filtering.single_collection.workflow %>
        <% workflow.stages.each do |stage| %>
          <%= render "cards/index/engagement/doing", user_filtering: user_filtering, **doing.to_h, stage: stage %>
        <% end %>
      <% end %>

      <%= render "cards/index/engagement/closed", user_filtering: user_filtering, **closed.to_h %>
    </div>
  <% end %>
<% end %>
